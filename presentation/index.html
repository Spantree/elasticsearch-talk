<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Spantree - Elasticsearch</title>

    <meta name="description" content="Spantree talks about Elasticsearch">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/sky.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <link rel="stylesheet" href="custom_css/sublime_monokai.css">

    <!-- Spantree customizations -->
    <link rel="stylesheet" href="custom_css/spantree.css">
    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <!--INTRODUCTION-->
        <section>
          <section data-markdown id="title">
            <script type="text/template">
            Hey guys!

            ![Spantree logo](images/spantree.svg)

            is talking about

            ![Elasticsearch](images/elasticsearch.png)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template" class="logos">
              ## Who We Are

              <table class="ourpictures">
                <tr>
                  <td vertical-align="top">
                    ![Malynda](images/malynda.png)
                    <br/>
                    <p>Malynda Chizek Frouard</p>
                    <p>Junior Software Engineer</p>
                  </td>
                  <td>
                    ![Kevin](images/kevin.png)
                    <br/>
                    <p>Kevin Greene</p>
                    <p>Senior Software Engineer</p>
                  </td>
                  <td>
                    ![Cedric](images/cedric.png)
                    <br/>
                    <p>Cedric Hurst</p>
                    <p>Principal</p>
                  </td>
                  <td>
                    ![Gary](images/gary.png)
                    <br/>
                    <p>Gary Turovsky</p>
                    <p>Senior Software Engineer</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    ![Allie](images/allie.png)
                    <br/>
                    <p>Allie Curry</p>
                    <p>Senior Software Engineer</p>
                  </td>
                  <td vertical-align="top">
                    ![Roberto](images/roberto.png)
                    <br/>
                    <p>Roberto Guerra</p>
                    <p>Senior Software Engineer</p>
                  </td>
                  <td>
                    ![Andrea](images/andrea.png)
                    <br/>
                    <p>Andrea Schuster</p>
                    <p>Director of Operations</p>
                  </td>
                  
                <tr>
              </table>
            </script>
          </section>
          <section data-markdown class="logos">
            <script type="text/template" >
              ## What We Work On

              ![Arena](images/arena.png)
              ![Chicago.com](images/chicagocom.png)
              ![NMH](images/nmh.gif)
              ![Channel company](images/channelcompany.gif)
              ![Doejo](images/doejo.png)
              ![MileIQ](images/mileiq.png)
              ![High School Cube](images/highschoolcube.png)
              ![Hosted Buyer](images/hostedbuyer.png)
              ![Wrapports](images/wrapports.png)
              ![GoHealth](images/gohealth.png)
              ![Mobiquity](images/mobiquity.png)
              ![Panera](images/panera.png)
            </script>
          </section>
          <section data-markdown class="logos">
            ## Stuff We Use

            ![Amazon Web Services](images/aws.svg)
            ![Github](images/github.svg)
            ![Vagrant](images/vagrant.png)
            ![Puppet](images/puppet.svg)

            ![PostgreSQL](images/postgres.svg)
            ![MongoDB](images/mongodb.png)
            ![Neo4J](images/neo4j.svg)
            ![Elasticsearch](images/elasticsearch.png)

            ![Java](images/java.svg)
            ![Groovy](images/groovy.svg)
            ![Grails](images/grails.svg)
            ![Marionette.js](images/marionettejs.png)


            ![Dojo](images/dojo.svg)
            ![jQuery](images/jquery.svg)
            ![Coffeescript](images/coffeescript.svg)
            ![Backbone.js](images/backbone.png)

          </section>
        </section>
        <section>
          <section data-markdown>
            <script type="text/template">
              ![Elasticsearch logo](images/elasticsearch.png)

              <p><img src="images/kimchy.jpeg" style="width:50px;vertical-align:text-top"> "You know, for Search!"</p>
            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ![Cote Tweet](images/cote-tweet.png)
            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ## The Challenge

              ![Simplicity](images/simplicity.png)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### How We Query

              #### SQL Database

              ```sql
              SELECT *
              FROM Person INNER JOIN Scientist ON Person.ID = Scientist.ID
              WHERE FirstName LIKE "Edgar%" And LastName = "Codd";
              ```

              #### MongoDB

              ```javascript
              db.spantree.find({firstName: "Eric", lastName: "Evans"});
              ```

              #### Elasticsearch

              ```json
              GET /spantree/_search

              {"query": { "bool": {"must": [
                {"query_string": {"query": "vannevar bush"}}
              ]}}}
              ```

              <!--TODO: Add Elasticsearch family tree-->
            </script>
          </section>
          
          <section data-markdown>
            <script type="text/template">
              ### What People Expect

              <table class="examples">
                <tbody>
                  <tr>
                    <th>Lowercase</th>
                    <td>iPhone</td>
                    <td>&#8781;</td>
                    <td>iphone</td>
                  </tr>
                  <tr>
                    <th>Stemming</th>
                    <td>Runner</td>
                    <td>&#8781;</td>
                    <td>Running</td>
                  </tr>
                  <tr>
                    <th>Synonyms</th>
                    <td>Car</td>
                    <td>&#8781;</td>
                    <td>Automobile</td>
                  </tr>
                  <tr>
                    <th>Word delimiters</th>
                    <td>Show-off</td>
                    <td>&#8781;</td>
                    <td>Show off</td>
                  </tr>
                  <tr>
                    <th>ASCII Folding</th>
                    <td>Nestlé</td>
                    <td>&#8781;</td>
                    <td>Nestle</td>
                  </tr>
                  <tr>
                    <th>Pattern Replace</th>
                    <td>(888) 386-5501</td>
                    <td>&#8781;</td>
                    <td>888.386.5501</td>
                  </tr>
                  <tr>
                    <th>Edge NGram</th>
                    <td>ela</td>
                    <td>&#8781;</td>
                    <td>elasticsearch</td>
                  </tr>
                </tbody>
              </table>
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### What People Expect
              #### Searching Across Fields

              
              ```json
              {
                "product": {
                  "name": "nifty doodad",
                  "description": "this is an example"
                }
              }
              ```

              This document should match <em>example doodad</em>

              
              <!-- TODO: Fill in with multi-match example -->
            </script>
          </section>
        </section>
        <section class="screenshots">
          <section data-markdown>
            <script type="text/template">
              ## Elasticsearch Is...
            </script>
          </section>
          <section data-markdown class="screenshot-dark">
            <script type="text/template">
              ### Wicked Fast

              ![ApacheBench Results](images/ab-results.png)

              <!--TODO: Annotate with what the screenshot actually says-->
            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ### Highly Configurable

              ![HEAD Configuration](images/es-configurable.png)
            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ### Free and Open Source

              ![ES Github Repo](images/es-github.png)
            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ### Distributed and Fault Tolerant

              ![ES Github Repo](images/es-karmi.png)
            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ### Good at Handling Lots of Data

              ![ES Github Big Data](images/es-big-data-github.png)
            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ### ...Also Works With Unstructured Data

              ![ES Hamlet](images/es-shakespeare-json.png)
            </script>
          </section>
          <section data-markdown class="screenshot-dark">
            <script type="text/template">
              ### ...And Real-Time Analytics

              ![ES Hamlet](images/logstash-search-screenshot.png)
            </script>
          </section>
        </section>
        <section>
          <section data-markdown>
            <script type="text/template">
              ## Elasticsearch Isn&#39;t...
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### A Relational Database

              ![PostgreSQL](images/postgres.svg)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Transactional
            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ### A Crawler

              ![Apache Nutch](images/nutch.png)
            </script>
          </section>
          <section data-markdown class="logos-big">
            <script type="text/template">
              ### A Machine Learner
              ![Apache Mahout](images/mahout.svg)
              <!--![Apache Spark](images/spark.png)-->
              ![Carrot2](images/carrot2.png)
            </script>
          </section>
          <section data-markdown class="logos-big">
            <script type="text/template">
              ### A User-Facing Search Experience

              ![Do It Yourself](images/do-it-yourself.svg)
            </script>
          </section>
          <section data-markdown class="logos-big">
            <script type="text/template">
              ### Secure

              ![Vault](images/safe.svg)
            </script>
          </section>
        </section>
        <section>
          <section data-markdown>
            <script type="text/template">
              ## How It Works
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### What does querying an index do?

              * Find the documents that match the query
              * Score the documents 

            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Inverted index

              ![Book Index](images/book-index.png)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Inverted index

              * Maps word to document or position
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Finding the right document

              <table class="documents">
                <tr>
                  <th>0</th>
                  <th>1</th>
                  <th>2</th>
                </tr>
                <tr>
                  <td>
                    work it make it<br/>
                    do it makes us<br/>
                    harder better<br/>
                    faster stronger
                  </td>
                  <td>
                    more than hour,<br/>
                    hour never<br/>
                    ever after,<br/>
                    work is over
                  </td>
                  <td>
                    work it harder<br/>
                    make it better<br/>
                    do it faster<br/>
                    makes us stronger
                  </td>
                </tr>
              </table>
              <br/>
              <table style="margin: auto">
                <tr>
                  <td>work</td><td>&rarr;</td><td>0, 1, 2</td>
                </tr>
                <tr>
                  <td>hour</td><td>&rarr;</td><td>1</td>
                </tr>
                <tr>
                  <td>harder</td><td>&rarr;</td><td>0, 2</td>
                </tr>
              </table>

            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Finding position in document

              <table class="documents">
                <tr>
                  <th>0</th>
                  <th>1</th>
                  <th>2</th>
                </tr>
                <tr>
                  <td>
                    work it make it<br/>
                    do it makes us<br/>
                    harder better<br/>
                    faster stronger
                  </td>
                  <td>
                    more than hour,<br/>
                    hour never<br/>
                    ever after<br/>
                    work is over
                  </td>
                  <td>
                    work it harder<br/>
                    make it better<br/>
                    do it faster<br/>
                    makes us stronger
                  </td>
                </tr>
              </table>
              <br/>
              <table style="margin: auto">
                <tr>
                  <td rowspan="3">work</td><td rowspan="3">&rarr;</td><td>0:</td><td>{0}</td>
                </tr>
                <tr>
                  <td>1:</td><td>{7}</td>
                </tr>
                <tr>
                  <td>2:</td><td>{0}</td>
                </tr>
                <tr>
                  <td>hour</td><td>&rarr;</td><td>1:</td><td>{2, 3}</td>
                </tr>
                <tr>
                  <td rowspan="2">harder</td><td rowspan="2">&rarr;</td><td>0:</td><td>{8}</td>
                </tr>
                <tr>
                  <td>2:</td><td>{2}</td>
                </tr>
                <tr>
                  <td rowspan="3">it</td><td rowspan="3">&rarr;</td><td>0:</td><td>{1, 3, 5}</td>
                </tr>
                <tr>
                  <td>2:</td><td>{1, 4, 7}</td>
                </tr>
              </table>
              <br/>
              Does "work it" occur in a document?
            </script>
          </section>
          

          <section data-markdown data-separator="^\n===\n$" data-vertical="^\n---\n$">
            <script type="text/template">
              ### TF-IDF Scoring Of Documents
              $tf \times idf = tf \times \log{ \frac{N}{df} }$

              * <em>term frequency ($tf$)</em> number of times a term occurs in a particular document
              * <em>document frequency ($df$)</em> number of all documents a term occurs in 
              * <em>inverse document frequency ($idf$)</em> is (usually) $\log{\frac{N}{df}}$, where $N$ is the number of documents in the index

            </script>
          </section>
          <section data-markdown data-separator="^\n===\n$" data-vertical="^\n---\n$">
            <script type="text/template">
              ### Scoring our example

              <table style="margin: auto">
                <tr>
                  <td rowspan="3">work</td><td rowspan="3">&rarr;</td><td>0:</td><td>{0}</td>
                </tr>
                <tr>
                  <td>1:</td><td>{7}</td>
                </tr>
                <tr>
                  <td>2:</td><td>{0}</td>
                </tr>
                <tr>
                  <td>hour</td><td>&rarr;</td><td>1:</td><td>{2, 3}</td>
                </tr>
                <tr>
                  <td rowspan="2">harder</td><td rowspan="2">&rarr;</td><td>0:</td><td>{8}</td>
                </tr>
                <tr>
                  <td>2:</td><td>{2}</td>
                </tr>
              </table>


              <table class="tf-idf">
                <tr>
                  <th></th>
                  <th>work</th>
                  <th>hour</th>
                  <th>harder</th>
                </tr>
                <tr>
                  <td>0:</td><td>$1 \times \log{\frac{3}{3}}$</td><td>$0 \times \log{\frac{3}{1}}$</td><td>$1 \times \log{\frac{3}{2}}$</td>
                </tr>
                <tr>
                  <td>1:</td><td>$1 \times \log{\frac{3}{3}}$</td><td>$2 \times \log{\frac{3}{1}}$</td><td>$0 \times \log{\frac{3}{2}}$</td>
                </tr>
                <tr>
                  <td>2:</td><td>$1 \times \log{\frac{3}{3}}$</td><td>$0 \times \log{\frac{3}{1}}$</td><td>$1 \times \log{\frac{3}{2}}$</td>
                </tr>
              <table>
            </script>
          </section>
          <section data-markdown data-separator="^\n===\n$" data-vertical="^\n---\n$">
            <script type="text/template">
              ### Scoring our example
              <table class="scoring">
                <tr>
                  <th></th>
                  <th>work</th>
                  <th>hour</th>
                  <th>harder</th>
                </tr>
                <tr>
                  <td>0:</td><td>0</td><td>0</td><td>.35</td>
                </tr>
                <tr>
                  <td>1:</td><td>0</td><td>.95</td><td>0</td>
                </tr>
                <tr>
                  <td>2:</td><td>0</td><td>0</td><td>.35</td>
                </tr>
              <table>
              <br/>

              * Create a vector for the query: $\[1,1,1\]$
              * Take the cosine-similarity of the two vectors
                * Gives the cosine of the angle between two vectors
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### The Lucene Library

              ![Lucene](images/lucene.png)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### How it *really* works

              * [http://lucene.apache.org/core/4_0_0/core/overview-summary.html](http://lucene.apache.org/core/4_0_0/core/overview-summary.html)
              * [http://wiki.apache.org/lucene-java/LucenePapers](http://wiki.apache.org/lucene-java/LucenePapers)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Terminology Overview

              ![Index Structure](images/index-structure.svg)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Terminology Overview

              ![Document Structure](images/document-structure.svg)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Indexes

              One or more Lucene indexes, composed of segments

            </script>
          </section>
          <section data-markdown class="screenshot">
            <script type="text/template">
              ### Lucene segement merging in action
              <iframe width="560" height="315" src="//www.youtube.com/embed/YW0bOvLp72E?rel=0" frameborder="0" allowfullscreen></iframe>
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Documents

              ```json
              {
                "_index": "index_name",
                "_type": "document_type",
                "_id": 1337,
                "_source": {
                  "field0": 777,
                  "field1": "value",
                  "field2": ["value1","value2","value3"],
                  "field3": {
                    "subfield0":"value1",
                    "subfield1":"value2"
                  } 
                }
              }
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Types and Mappings
              * The fields a document should have
              * The data type of each field
              * Analysis
                * How to generate tokens from document (indexing)
                * How to generate tokens from query string (searching)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Data Types

              * string
              * integer/long
              * float/double
              * boolean
              * ip
              * geo point
              * geo shape
              * attachment
              * object
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Analyzer

              ![Analysis phases](images/analysis-chain.svg)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Mappings and analysis

              ![Mapping and analysis](images/mapping-analysis.svg)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Clustering: Sharding and Replication

              * <em>Shard</em> - A slice of an index
                * More shards means better write performance
                * Single Lucene index (portion of Elasticsearch index)
              * <em>Replica</em> - Copy of a shard
                * More replicas means faster queries
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Example

              ![Analysis phases](images/sharding-replica.svg)
            </script>
          </section>
          <section>
            <script type="text/template">
              ### Failover

              * When a Node Fails
                * If Master Elect a new Master
                * Replicas are promoted to primary shards
                * Cluster status is yellow but operational
            </script>
          </section>
        </section>
        <section>
          <section data-markdown>
            <script type="text/template">
              ## Installing on Windows
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Configuring your environment

              * Install Java 7 or 8
              * Configure your `JAVA_HOME`
              * Download the Elasticsearch zip file from web
              * Extract to destination directory (e.g. C:\elasticsearch)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Starting Elasticsearch

              ```
              cd C:\elasticsearch\elasticsearch-1.2.1\bin
              ./elasticsearch
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Installing plugins

              ```
              cd C:\elasticsearch\elasticsearch-1.2.1\bin
              ./plugin -i lukas-vlcek/bigdesk
              ./plugin -i elasticsearch/marvel/latest
              ./plugin -i mobz/elasticsearch-head
              ./elasticsearch
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Configuring a cluster with multicast

              * Just works out the box (usually)
              * Repeat the process on two machines on the same subnet
              * They will (usually) discover each other via multicast
              * Must have the same cluster name
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Configuring a cluster with explicit IPs

              Modify `config/elasticsearch.yml`

              ```
              discovery.zen.ping.multicast.enabled: false
              discovery.zen.ping.unicast.hosts: ["192.168.0.250[9300-9400]", "192.168.0.251[9300-9400]"]
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Configuring as a Windows service

              ```
              cd C:\elasticsearch\elasticsearch-1.2.1\bin
              ./service install
              ```
            </script>
          </section>
        </section>
        <section>
          <section data-markdown>
            <script type="text/template">
              ## Indexing
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Anatomy of a Request

              ```bash
              curl -XPUT 'http://esdemo.local:9200/wikipedia/location/1' -d '{
                "name": "Spantree Technology Group, LLC",
                "about" : "Spantree is a boutique, Chicago-based consultancy delivering intelligent, high quality software solutions for the web.",
                "lastUpdated":"2013-12-30T02:14:41+0000",
                "yearFounded":2009
              }'
              ```

              </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Automatic Mappings

              ![AutomaticMapping](images/automatic-mapping.png)              
              </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Create or Update Document

              ```bash
              curl -XPUT 'http://esdemo.local:9200/wikipedia/location/1' -d '{
                "name": "Spantree Technology Group, LLC",
                "about" : "Spantree is a boutique, Chicago-based consultancy delivering intelligent, high quality software solutions for the web.",
                "lastUpdated":"2013-12-30T02:14:41+0000",
                "yearFounded":2009
              }'
              ```

              ```bash

              curl -XPOST 'http://esdemo.local:9200/wikipedia/location/' -d '{
                "name": "Spantree Technology Group, LLC",
                "about" : "Spantree is a boutique, Chicago-based consultancy delivering intelligent, high quality software solutions for the web.",
                "lastUpdated":"2013-12-30T02:14:41+0000",
                "yearFounded":2009
              }'
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Update API
              
              ```bash
              curl -XPOST 'http://esdemo.local:9200/wikipedia/location/1/_update' -d '{
                "script": "ctx._source.lastUpdated = date",
                "params": {
                  "date": "2014-02-18T02:14:41+0000"
                }
              }'
              ```

              ```bash
              curl -XPOST 'http://esdemo.local:9200/wikipedia/location/1/_update' -d '{
                "doc": {
                  "lastUpdated": "2014-02-18T02:14:41+0000"
                }
              }'
              ```



              </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Bulk API
       
              ```bash
              $ cat divvy.json

              {"index": {"_type": "station", "_id": "119"}}
              {"capacity": 15, "name": "Lake Park Ave & 56th St", "location": {"lat": 41.793242, "lon": -87.587782}}
              {"index": {"_type": "station", "_id": "353"}}
              {"capacity": 15, "name": "Ada St & Washington Blvd", "location": {"lat": 41.88283, "lon": -87.661206}}
              ```

              ```bash
              curl -f -s -S -XPOST --data-binary "@divvy.json" http://esdemo.local:9200/divvy/_bulk
              ```
            </script>
          </section>
        </section>
        <section>
          <section data-markdown>
            <script type="text/template">
              ## Querying
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Search API

              ```bash
              curl -XGET http://esdemo.local:9200/wikipedia/_search?q=about:lake
              ```

              or

              ```bash
              curl -XGET "http://esdemo.local:9200/wikipedia/_search" -d '{
                "query" : {
                  "term" : { "about" : "lake" }
                }
              }'
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              <h3>Types of Queries</h3>

              <table>
              <tr><td>match</td><td>multi match </td><td> bool</td><tr>                

              <tr><td> boosting  </td><td> common terms </td><td nowrap> constant score </td><tr> 
             <tr><td>  dis max  </td><td>filtered  </td><td> fuzzy like this </td><tr> 
             <tr><td>  fuzzy like this field </td><td> function score </td><td> fuzzy </td><tr> 
             <tr><td>  geoshape </td><td>has child  </td><td>has parent </td><tr> 
           <tr><td>    ids </td><td>indices  </td><td>  match all </td><tr> 
             <tr><td>  more like this </td><td>  more like this field  </td><td> nested </td><tr> 
             <tr><td>   prefix </td><td> query_string   </td><td>  simple query </td><tr>
            <tr><td>    range</td><td> regexp   </td><td> span first </td><tr> 
         <tr><td>      span multi term  </td><td> span near  </td><td> span not </td><tr> 
           <tr><td>     span or  </td><td> span term  </td><td> term </td><tr> 
            <tr><td>   terms </td><td> top children  </td><td> wildcard</td><tr> 
            <tr><td nowrap>   minimum should match  </td><td nowrap> multi term query rewrite</td><tr> 
              </table>
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              <h3>Types of Queries</h3>

              <table>
              <tr><td>match</td><td><b>multi match </b> </td><td> <b> bool </b></td><tr>                

              <tr><td> <b>boosting </b>  </td><td> common terms </td><td nowrap> constant score </td><tr> 
             <tr><td>  dis max  </td><td>filtered  </td><td> fuzzy like this </td><tr> 
             <tr><td>  fuzzy like this field </td><td> function score </td><td> fuzzy </td><tr> 
             <tr><td>  geoshape </td><td>has child  </td><td>has parent </td><tr> 
           <tr><td>    ids </td><td>indices  </td><td>  match all </td><tr> 
             <tr><td>  more like this </td><td>  more like this field  </td><td> nested </td><tr> 
             <tr><td>   prefix </td><td> <b>query_string</b>   </td><td>  simple query </td><tr>
            <tr><td>   <b> range </b></td><td> regexp   </td><td> span first </td><tr> 
         <tr><td>      span multi term  </td><td> span near  </td><td> span not </td><tr> 
           <tr><td>     span or  </td><td> span term  </td><td> <b>term </b> </td><tr> 
            <tr><td>   terms </td><td> top children  </td><td> wildcard</td><tr> 
            <tr><td nowrap>   minimum should match  </td><td nowrap> multi term query rewrite</td><tr> 
              </table>
            </script>
          </section>

          <section data-markdown>
            <script type="text/template">
              ### Scoring

              * Defaults to Okapi BM25
              * Modified via boosting
              * Can rewrite scoring engine

              </script>
          </section>
          <section data-markdown>
            <script type="text/template">
            ### Queries vs Filters

            <table class="qvf">
            <tr>
              <th>Queries</th>
              <th>Filters</th>
            </tr>
            <tr>
              <td>Fuzzy</td>
              <td>Boolean</td>
            </tr>
            <tr>
              <td>Slower</td>
              <td>Faster</td>
            </tr>
            <tr>
              <td>Never cached</td>
              <td>Cacheable</td>
            </tr>
            </table>

            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Filter on Red and Green

              ![Ornaments](images/red-and-green-ornaments.jpg)
              ![MM](images/red-green-m-m.jpg)
              ![RedGreen](images/red_green.jpg)



            </script>
          </section>

          <section data-markdown>
            <script type="text/template">
              ### Query on Red and Green - Also returns

              ![Red](images/red.png)
              ![Green](images/green.png)
              ![Blue](images/blue.svg)


            </script>
          </section>


          <section data-markdown>
            <script type="text/template">
              ### Facets

              ![Amazon](images/amazon-java.png)
              ![Airbnb](images/airbnb.png)

              </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Aggregations

              * The new facets
              * Allow for hierarchical data analysis
              </script>
          </section>

        </section>
        <section>
          <section data-markdown>
            <script type="text/template">
              ## Connecting from .NET
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Connections

              * JVM clients typically use the Transport layer (9300)
              * Non-JVM clients typically use HTTP-REST (9200) or Thrift (9400)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Available Libraries
              
              * [PlasticElastic.net](https://github.com/Yegoroff/PlainElastic.Net) (command builder pattern)
              * [NEST](https://github.com/Mpdreamz/NEST) (High-Level)
              * [Elasticsearch.net](https://github.com/medcl/ElasticSearch.Net) (Low-Level)
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### PlasticElastic
              
              ```c#
              // 1. It provides ES HTTP connection
              var connection  = new ElasticConnection("localhost", 9200);

              // 2. And sophisticated ES command builders:
              string command = Commands.Index(index: "twitter", type: "user", id: test)

              // 3. And gives you the ability to serialize your objects to JSON:  
              var serializer = new JsonNetSerializer();
              var tweet = new Tweet { Name = "Some Name" };
              string jsonData = serializer.ToJson(tweet);

              // 4. Then you can use appropriate HTTP verb to execute ES command:
              string response = connection.Put(command, jsonData);

              // 5. And then you can deserialize operation response to typed object to easily analyze it:
              IndexResult indexResult = serializer.ToIndexResult(result);
              if(indexResult.ok) {
                 ... // do something useful.
              }
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### NEST


              ```c#
              public class Person
              {
                  public string Id { get; set; }
                  public string Firstname { get; set; }
                  public string Lastname { get; set; }
              }

              var person = new Person
              {
                  Id = "1",
                  Firstname = "Martijn",
                  Lastname = "Laarman"
              };
              var index = client.Index(person);
              ```
            </script>
          </section>
        </section>
        <section data-markdown>
            <script type="text/template">
              ## Elasticsearch.net

              ```c#
              var client = new ElasticSearchClient(“localhost”);
              client.CreateIndex("index", new IndexSetting(5, 1));
              client.Index("testindex", "testtype", "testkey", "{\"a\":\"b\"}");
              ```
            </script>
        </section>

        <section>
          <section data-markdown>
            <script type="text/template">
              ## Cluster Design
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Master Nodes

              * Elected on a per-cluster basis and primarily responsible for coordination
              * Keeps track of all the other nodes
              * Is replaced by another master-eligible node if current master fails
              * Routes new documents to data node holding the primary shard
              * Handles collating responses from shards, doing sorting, pagination, etc 
              * Nodes electable as master by setting `node.master: true` in `elasticsearch.yml` 
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Data nodes

              * Holds one or more primary and replica shards
              * Responsible for indexing data on its primary shards
              * Responsible for querying data on its primary and replica shard
              * Nodes eligible as data nodes by setting `node.data: true` in `elasticsearch.yml`
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### When to use dedicated masters

              * When you have critical clusters
              * When you have high write or read throughput
              * Always have an odd number to avoid split brain
              * Still vulnerable to some [split brain issues](http://github.com/elasticsearch/elasticsearch/issues/2488)
              * Improvements coming in 1.3.0 hopefully
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Shard allocation

              * Happens during initial recovery, replica allocation, rebalancing, and node addition/removal
              * Shard allocation awareness allows us to ensure that a primary shard and its replica will not be collocated to a node with the same value 
            </script>
          </secton>
          <section data-markdown>
            <script type="text/template">
              ### Configuring shard allocation awareness

              ```yaml
              node.rack_id: rack_one
              cluster.routing.allocation.awareness.attributes: rack_id
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Planning for resiliency
              
              * Prefer bulk updates when possible, buffering updates to reduce data loss
              * Force a refresh at the as an ACK
              * Use an external message queue (RabbitMQ, Kafka, etc) to feed events into Elasticsearch
              * If you run into issues, consider using alternative discovery plugins (e.g. [sonian-zookeeper](https://github.com/sonian/elasticsearch-zookeeper))
            </script>
          </section>
        </section>
        <section>
          <section data-markdown>
            <script type="text/template">
              ## Securing Elasticsearch
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Securing Elasticsearch
            </script>
          </section>
        <section>
          <h3>Have fun with Elasticsearch!</h3>
          <iframe class="vine-embed" src="https://vine.co/v/M7rdWEdIrtq/embed/simple" width="600" height="600" frameborder="0"></iframe>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>
    <script src="https://platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>
    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          {
            src: 'lib/js/classList.js',
            condition: function() { return !document.body.classList; }
          },
          {
            src: 'plugin/markdown/marked.js',
            condition: function() { return !!document.querySelector( '[data-markdown]' ); }
          },
          {
            src: 'plugin/markdown/markdown.js',
            condition: function() { return !!document.querySelector( '[data-markdown]' ); }
          },
          {
            src: 'plugin/highlight/highlight.js',
            async: true,
            callback: function() { hljs.initHighlightingOnLoad(); }
          },
          {
            src: 'plugin/zoom-js/zoom.js',
            async: true,
            condition: function() { return !!document.body.classList; }
          },
          {
            src: 'plugin/notes/notes.js',
            async: true,
            condition: function() { return !!document.body.classList; }
          },
          { 
            src: 'plugin/math/math.js', 
            async: true 
          }
        ]
      });

    </script>

  </body>
</html>
